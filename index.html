<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>今日の振り返り</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="app-body">
  <div class="app-shell">
    <header class="header-section">
      <h1 class="app-title">今日の振り返り</h1>
      <p class="app-subtitle" id="today-label"></p>
      <div class="header-date-controls">
        <label class="header-date-controls__label" for="date-picker">表示する日付</label>
        <div class="header-date-controls__row">
          <input class="header-date-controls__input" type="date" id="date-picker" />
          <div class="header-date-controls__buttons">
            <button class="date-navigation__button" id="prev-btn" type="button">前日</button>
            <button class="date-navigation__button date-navigation__button--primary" id="today-btn" type="button">今日</button>
            <button class="date-navigation__button" id="next-btn" type="button">次の日</button>
          </div>
        </div>
        <p class="header-date-controls__current" id="viewing-date"></p>
      </div>
      <div class="header-actions">
        <span class="header-actions__user" id="auth-user-label" hidden></span>
        <button class="header-actions__button header-actions__button--secondary" id="sign-out-btn" type="button" hidden>
          ログアウト
        </button>
        <button class="header-actions__button" id="history-btn" type="button">履歴を見る</button>
      </div>
    </header>

    <main class="app-main">

      <section class="card app-section habit-list-section">
        <div class="section-title-row">
          <h2 class="section-title">習慣チェック</h2>
          <button class="habit-edit-button" id="edit-habits-btn" type="button">習慣を編集</button>
        </div>
        <ul class="habit-list__items" id="habit-list"></ul>
      </section>

      <section class="card app-section diary-form-section">
        <h2 class="section-title">日記フォーム</h2>
        <div class="field-group">
          <label class="field-group__label" for="diary">日記</label>
          <textarea class="field-group__textarea" id="diary" rows="6"></textarea>
        </div>
        <div class="field-group">
          <label class="field-group__label" for="memo">メモ</label>
          <textarea class="field-group__textarea" id="memo" rows="4"></textarea>
        </div>
      </section>

      <section class="card app-section action-menu-section">
        <h2 class="section-title">アクション</h2>
        <p class="offline-warning" id="offline-warning" role="alert" hidden>
          現在オフラインです。接続が回復したら保存を再試行してください。
        </p>
        <div class="action-menu__content">
          <button class="action-menu__button" id="save-btn" type="button">保存</button>
          <button class="action-menu__button action-menu__button--secondary" id="export-btn" type="button">エクスポート</button>
          <span class="action-menu__status" id="save-status"></span>
        </div>
      </section>

      <section class="card debug-panel">
        <h2 class="section-title">デバッグ表示</h2>
        <pre class="debug-panel__output" id="debug-output"></pre>
      </section>
    </main>
  </div>

  <div class="toast" id="app-toast" role="status" aria-live="polite" hidden></div>

  <div class="modal" id="auth-modal" hidden>
    <div class="modal__overlay"></div>
    <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="auth-modal-title">
      <h2 class="modal__title" id="auth-modal-title">ログイン</h2>
      <p class="modal__description">
        データにアクセスするにはメールアドレスとパスワードでログインしてください。
      </p>
      <form class="modal__form" id="auth-form" autocomplete="on">
        <label class="field-group" for="auth-email">
          <span class="field-group__label">メールアドレス</span>
          <input class="field-group__input" id="auth-email" type="email" autocomplete="email" required />
        </label>
        <label class="field-group" for="auth-password">
          <span class="field-group__label">パスワード</span>
          <input class="field-group__input" id="auth-password" type="password" autocomplete="current-password" required />
        </label>
        <button class="modal__submit" type="submit">ログイン</button>
      </form>
      <p class="modal__error" id="auth-error" role="alert"></p>
    </div>
  </div>

  <div class="modal" id="export-modal" hidden>
    <div class="modal__overlay" data-modal-close></div>
    <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="export-modal-title">
      <button class="modal__close" type="button" data-modal-close aria-label="閉じる">×</button>
      <h2 class="modal__title" id="export-modal-title">CSV エクスポート</h2>
      <form class="modal__form" id="export-form">
        <div class="field-group">
          <label class="field-group__label" for="export-from">開始日</label>
          <input class="field-group__input" id="export-from" type="date" required />
        </div>
        <div class="field-group">
          <label class="field-group__label" for="export-to">終了日</label>
          <input class="field-group__input" id="export-to" type="date" required />
        </div>
        <button class="modal__submit" type="submit">CSV をダウンロード</button>
      </form>
      <p class="modal__error" id="export-error" role="alert"></p>
    </div>
  </div>

  <div class="modal" id="habit-modal" hidden>
    <div class="modal__overlay" data-modal-close></div>
    <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="habit-modal-title">
      <button class="modal__close" type="button" data-modal-close aria-label="閉じる">×</button>
      <h2 class="modal__title" id="habit-modal-title">習慣を編集</h2>

      <section class="modal__section">
        <h3 class="modal__section-title">既存の習慣</h3>
        <div class="habit-editor__list" id="habit-editor-list"></div>
        <p class="habit-editor__empty" id="habit-editor-empty" hidden>習慣が登録されていません</p>
      </section>

      <section class="modal__section">
        <h3 class="modal__section-title">新しい習慣を追加</h3>
        <form class="habit-editor__form" id="new-habit-form">
          <div class="habit-editor__grid">
            <label class="field-group">
              <span class="field-group__label">名前</span>
              <input class="field-group__input" name="name" required />
            </label>
            <label class="field-group">
              <span class="field-group__label">タイプ</span>
              <input class="field-group__input" name="type" required />
            </label>
            <label class="field-group">
              <span class="field-group__label">単位</span>
              <input class="field-group__input" name="unit" />
            </label>
            <label class="habit-editor__checkbox">
              <input type="checkbox" name="active" checked />
              <span>アクティブにする</span>
            </label>
          </div>
          <button class="modal__submit" type="submit">追加する</button>
        </form>
        <p class="habit-editor__error" id="habit-editor-error" role="alert"></p>
      </section>
    </div>
  </div>

  <div class="modal" id="history-modal" hidden>
    <div class="modal__overlay" data-modal-close></div>
    <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="history-modal-title">
      <button class="modal__close" type="button" data-modal-close aria-label="閉じる">×</button>
      <h2 class="modal__title" id="history-modal-title">履歴を見る</h2>

      <section class="modal__section">
        <h3 class="modal__section-title">習慣を選択</h3>
        <label class="field-group">
          <span class="field-group__label">習慣</span>
          <select class="field-group__input" id="history-habit-select"></select>
        </label>
        <p class="history-modal__empty" id="history-empty" hidden>表示できる習慣がありません</p>
        <p class="history-modal__status" id="history-status"></p>
      </section>

      <section class="modal__section">
        <h3 class="modal__section-title">直近30日の推移</h3>
        <div class="history-chart" id="history-chart-container">
          <canvas id="history-chart" aria-describedby="history-chart-empty"></canvas>
        </div>
        <p class="history-chart__empty" id="history-chart-empty" hidden>グラフに表示できるデータがありません</p>
      </section>

      <section class="modal__section">
        <h3 class="modal__section-title">カレンダー表示</h3>
        <div class="history-calendar" id="history-calendar" aria-live="polite"></div>
        <p class="history-calendar__empty" id="history-calendar-empty" hidden>カレンダーに表示できるデータがありません</p>
      </section>
    </div>
  </div>

  <script
    defer
    src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"
    crossorigin="anonymous"
  ></script>
  <script type="module" src="./main.js"></script>
</body>
</html>
